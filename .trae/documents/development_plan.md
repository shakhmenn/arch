# План доработки системы TFC для бизнес-клуба "The Arch Club"

## 1. Анализ текущего состояния системы

### Существующая архитектура
- **Бэкенд**: NestJS + TypeScript + PostgreSQL + Prisma ORM
- **Фронтенд**: React 19 + TypeScript + Vite + Feature-Sliced Design
- **Аутентификация**: JWT + Passport
- **База данных**: PostgreSQL с основными сущностями (User, Team, Task, Comment)

### Текущие возможности
- ✅ Система аутентификации (регистрация/вход)
- ✅ Управление пользователями (роли ORGANIZER/ENTREPRENEUR)
- ✅ Управление командами
- ✅ Система задач с подзадачами
- ✅ Комментарии к задачам
- ✅ Базовая система уведомлений

### Проблемы для устранения
- ❌ TypeScript ошибки в фронтенде (JSX конфигурация)
- ❌ Неполная реализация UI компонентов
- ❌ Отсутствие мобильной адаптации

## 2. Новые функциональные требования

### 2.1 Расширенные профили участников
- Личная информация участника
- Информация о бизнесе
- "Точка А" и "Точка В" по ключевым показателям
- План-факт анализ по различным метрикам
- История развития и достижений

### 2.2 Система трекинга привычек
- Создание и управление привычками
- Ежедневное отслеживание выполнения
- Статистика и аналитика по привычкам
- Напоминания и мотивационные элементы

### 2.3 Дашборды и аналитика
- **Личный дашборд участника**:
  - Прогресс по задачам
  - Статистика привычек
  - Динамика ключевых показателей
  - Календарь активности
- **Групповой дашборд**:
  - Общая статистика группы
  - Рейтинг участников
  - Коллективные достижения

### 2.4 Система посещений и мероприятий
- Журнал посещения групповых встреч
- Учет посещения обучающих мероприятий
- Календарь событий клуба
- Статистика активности участников

### 2.5 Административные функции
- Управление группами и их составом
- Ведение журналов посещений
- Аналитика по всему клубу
- Система отчетности

## 3. Техническая архитектура

### 3.1 Обновления базы данных
```sql
-- Новые таблицы
CREATE TABLE user_profiles (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  business_name VARCHAR(255),
  business_description TEXT,
  current_revenue DECIMAL(15,2),
  target_revenue DECIMAL(15,2),
  current_employees INTEGER,
  target_employees INTEGER,
  bio TEXT,
  avatar_url VARCHAR(500),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE habits (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  frequency_type VARCHAR(20), -- daily, weekly, monthly
  target_count INTEGER DEFAULT 1,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE habit_logs (
  id SERIAL PRIMARY KEY,
  habit_id INTEGER REFERENCES habits(id),
  date DATE NOT NULL,
  completed_count INTEGER DEFAULT 0,
  notes TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE metrics (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  metric_name VARCHAR(100) NOT NULL,
  metric_type VARCHAR(50), -- revenue, employees, customers, etc
  planned_value DECIMAL(15,2),
  actual_value DECIMAL(15,2),
  period_start DATE,
  period_end DATE,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE events (
  id SERIAL PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  event_type VARCHAR(50), -- meeting, training, social
  start_time TIMESTAMP NOT NULL,
  end_time TIMESTAMP NOT NULL,
  location VARCHAR(255),
  team_id INTEGER REFERENCES teams(id),
  created_by INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE attendances (
  id SERIAL PRIMARY KEY,
  event_id INTEGER REFERENCES events(id),
  user_id INTEGER REFERENCES users(id),
  status VARCHAR(20) DEFAULT 'registered', -- registered, attended, missed
  notes TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(event_id, user_id)
);
```

### 3.2 API Endpoints (новые)
```typescript
// Профили
GET    /api/profiles/:userId
PUT    /api/profiles/:userId
POST   /api/profiles/:userId/avatar

// Привычки
GET    /api/habits
POST   /api/habits
PUT    /api/habits/:id
DELETE /api/habits/:id
POST   /api/habits/:id/log
GET    /api/habits/:id/stats

// Метрики
GET    /api/metrics
POST   /api/metrics
PUT    /api/metrics/:id
GET    /api/metrics/dashboard

// События и посещения
GET    /api/events
POST   /api/events
PUT    /api/events/:id
POST   /api/events/:id/attend
GET    /api/events/:id/attendances

// Дашборды
GET    /api/dashboard/personal
GET    /api/dashboard/team/:teamId
GET    /api/dashboard/admin
```

### 3.3 Фронтенд архитектура (FSD)
```
src/
├── entities/
│   ├── profile/
│   ├── habit/
│   ├── metric/
│   ├── event/
│   └── attendance/
├── features/
│   ├── profile-management/
│   ├── habit-tracking/
│   ├── metrics-planning/
│   ├── event-management/
│   └── attendance-tracking/
├── widgets/
│   ├── personal-dashboard/
│   ├── team-dashboard/
│   ├── habit-tracker/
│   └── metrics-chart/
└── pages/
    ├── profile/
    ├── dashboard/
    ├── habits/
    ├── metrics/
    └── events/
```

## 4. Поэтапный план разработки

### Этап 1: Устранение технических проблем (1-2 недели)
**Приоритет: КРИТИЧЕСКИЙ**

#### 1.1 Исправление фронтенда
- [ ] Исправить TypeScript конфигурацию (JSX, module resolution)
- [ ] Настроить Vite конфигурацию для Tailwind CSS v4
- [ ] Запустить фронтенд без ошибок
- [ ] Базовая мобильная адаптация

#### 1.2 Стабилизация бэкенда
- [ ] Проверить все существующие API endpoints
- [ ] Добавить валидацию данных
- [ ] Настроить CORS для фронтенда

### Этап 2: Расширенные профили участников (2-3 недели)
**Приоритет: ВЫСОКИЙ**

#### 2.1 База данных
- [ ] Создать таблицу user_profiles
- [ ] Создать таблицу metrics
- [ ] Миграции базы данных

#### 2.2 Бэкенд
- [ ] ProfilesModule с CRUD операциями
- [ ] MetricsModule для план-факт анализа
- [ ] Загрузка аватаров пользователей
- [ ] API для статистики профиля

#### 2.3 Фронтенд
- [ ] Страница профиля пользователя
- [ ] Форма редактирования профиля
- [ ] Компонент загрузки аватара
- [ ] План-факт виджеты
- [ ] Мобильная версия профиля

### Этап 3: Система трекинга привычек (2-3 недели)
**Приоритет: ВЫСОКИЙ**

#### 3.1 База данных
- [ ] Создать таблицы habits и habit_logs
- [ ] Индексы для быстрых запросов

#### 3.2 Бэкенд
- [ ] HabitsModule с CRUD операциями
- [ ] API для логирования привычек
- [ ] Статистика и аналитика привычек
- [ ] Система напоминаний

#### 3.3 Фронтенд
- [ ] Страница управления привычками
- [ ] Ежедневный трекер привычек
- [ ] Календарь привычек
- [ ] Статистика и графики
- [ ] Мобильный трекер

### Этап 4: Дашборды и аналитика (3-4 недели)
**Приоритет: ВЫСОКИЙ**

#### 4.1 Бэкенд
- [ ] DashboardModule с агрегированными данными
- [ ] API для личной аналитики
- [ ] API для групповой аналитики
- [ ] Кэширование тяжелых запросов

#### 4.2 Фронтенд
- [ ] Личный дашборд участника
- [ ] Групповой дашборд
- [ ] Интерактивные графики и чарты
- [ ] Фильтры и временные периоды
- [ ] Адаптивные дашборды

### Этап 5: Система мероприятий и посещений (2-3 недели)
**Приоритет: СРЕДНИЙ**

#### 5.1 База данных
- [ ] Создать таблицы events и attendances
- [ ] Связи с командами и пользователями

#### 5.2 Бэкенд
- [ ] EventsModule для управления мероприятиями
- [ ] AttendanceModule для учета посещений
- [ ] Календарь событий API
- [ ] Уведомления о мероприятиях

#### 5.3 Фронтенд
- [ ] Календарь мероприятий
- [ ] Страница создания событий
- [ ] Система регистрации на события
- [ ] Журнал посещений
- [ ] Мобильный календарь

### Этап 6: Административные функции (2 недели)
**Приоритет: СРЕДНИЙ**

#### 6.1 Бэкенд
- [ ] AdminModule с расширенными правами
- [ ] API для управления группами
- [ ] Отчеты и аналитика
- [ ] Экспорт данных

#### 6.2 Фронтенд
- [ ] Административная панель
- [ ] Управление участниками
- [ ] Отчеты и статистика
- [ ] Настройки системы

### Этап 7: Подготовка к ИИ интеграции (1-2 недели)
**Приоритет: НИЗКИЙ**

#### 7.1 Архитектура
- [ ] Модуль для интеграции с ИИ сервисами
- [ ] API для передачи данных профиля
- [ ] Система промптов и контекста
- [ ] Логирование взаимодействий с ИИ

#### 7.2 Подготовка данных
- [ ] Структурирование данных для ИИ
- [ ] Анонимизация чувствительной информации
- [ ] API для получения рекомендаций

## 5. Технические требования

### 5.1 Производительность
- Время загрузки страниц < 2 секунд
- Поддержка 1000+ одновременных пользователей
- Оптимизация запросов к базе данных
- Кэширование часто используемых данных

### 5.2 Безопасность
- HTTPS для всех соединений
- JWT токены с коротким временем жизни
- Валидация всех входящих данных
- Защита от SQL инъекций и XSS
- Регулярные бэкапы базы данных

### 5.3 Мобильная адаптация
- Responsive design для всех экранов
- Touch-friendly интерфейс
- Оптимизация для медленных соединений
- Поддержка жестов и свайпов

## 6. Ресурсы и временные рамки

### Общее время разработки: 12-16 недель

### Команда разработки:
- 1 Full-stack разработчик (основной)
- 1 Frontend разработчик (по необходимости)
- 1 UI/UX дизайнер (консультации)

### Инструменты и технологии:
- **Управление проектом**: GitHub Projects
- **Дизайн**: Figma для макетов
- **Тестирование**: Jest, Cypress
- **Мониторинг**: Sentry для отслеживания ошибок
- **Деплой**: Docker + CI/CD pipeline

## 7. Критерии готовности

### MVP (Минимально жизнеспособный продукт)
- ✅ Исправлены все технические проблемы
- ✅ Работают расширенные профили
- ✅ Функционирует трекер привычек
- ✅ Доступны базовые дашборды
- ✅ Мобильная адаптация

### Полная версия
- ✅ Все функции из требований реализованы
- ✅ Административные возможности
- ✅ Система мероприятий
- ✅ Подготовка к ИИ интеграции
- ✅ Полное тестирование и оптимизация

## 8. Риски и митигация

### Технические риски
- **Проблемы с производительностью**: Раннее тестирование нагрузки
- **Сложность интеграции**: Поэтапная разработка с тестированием
- **Мобильная совместимость**: Регулярное тестирование на устройствах

### Проектные риски
- **Изменение требований**: Гибкая архитектура и модульность
- **Превышение сроков**: Буферное время в планах
- **Недостаток ресурсов**: Приоритизация функций

---

**Следующий шаг**: Получение одобрения плана и начало работы с Этапа 1.